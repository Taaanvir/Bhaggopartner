<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bhaggo Lanka Retreat Leaderboard</title>

<link rel="icon" href="https://www.bhaggo.co/favicon.ico">
<link href="https://fonts.googleapis.com/css2?family=Anek+Bangla:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
  background: url("bg.jpg") center / cover no-repeat fixed;
  color: #f5f6f7;
  font-family: 'Anek Bangla', sans-serif;
  margin: 0;
}

.site-header {
  position: sticky;
  top: 0;
  z-index: 999;
}

.site-header-top {
  background: #1f6a59;
  border-bottom: 1px solid rgba(255,255,255,0.12);
}

.site-container {
  max-width: 1180px;
  margin: 0 auto;
  padding: 0 16px;
}

.site-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  min-height: 70px;
}

.site-logo img {
  width: 170px;
  height: auto;
}

.site-actions {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.site-btn {
  display: inline-block;
  background: #e8b53a;
  color: #1a1a1a;
  font-weight: 700;
  padding: 8px 14px;
  border-radius: 999px;
  text-decoration: none;
  font-size: 13px;
}

.site-header-bottom {
  background: #fff;
  border-bottom: 1px solid #dfe6e2;
}

.site-menu {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.site-menu a {
  display: inline-block;
  color: #1f2d28;
  text-decoration: none;
  font-weight: 700;
  font-size: 14px;
  padding: 12px 14px;
  border-radius: 8px;
}

.site-menu a.active,
.site-menu a:hover {
  background: rgba(31,106,89,.1);
  color: #195444;
}

.leaderboard-page {
  display: flex;
  justify-content: center;
  padding: 20px;
}

.container {
  max-width: 800px;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.board-header { text-align: center; }

.logo img { width: 180px; }

.prize-link {
  margin-top: 6px;
  font-size: 14px;
  color: #ffd36a;
  cursor: pointer;
}
.prize-link:hover { text-decoration: underline; }

/* TOP 3 */
.top3 {
  display: grid;
  grid-template-columns: 1fr 1.2fr 1fr;
  gap: 14px;
  margin: 26px 0;
  align-items: end;
  width: 100%;
}

.top-card { text-align: center; }
.top-card img { width: 110px; }
.top-card.first img { width: 150px; }
.top-name { font-weight: 700; margin-top: 6px; }
.top-points { font-size: 14px; color: #d6d6d6; }

/* BOARD */
.board {
  background: rgba(0,0,0,0.45);
  backdrop-filter: blur(6px);
  border-radius: 12px;
  padding: 16px;
  width: 95%;        /* full width of container */
  max-width: 800px;   /* prevents it from getting too wide */
  box-shadow: 0 4px 10px rgba(0,0,0,0.4); /* subtle shadow only */
}

.header-row, .row {
  display: flex;
  justify-content: space-between;
  padding: 10px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}

.header-row {
  font-weight: bold;
  background-color: rgba(51,59,42,0.85);
  border-radius: 10px;
  margin-bottom: 4px;
}

.pos { width: 70px; }
.user { flex: 1; text-align: center; }
.prize { width: 120px; text-align: right; }

.meta {
  margin-top: 10px;
  text-align: right;
  font-size: 13px;
  color: #cfd6dc;
}

/* POPUP */
.popup-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(4px);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 999;
}

.popup {
  position: relative;
  background: rgba(0,0,0,0.88);
  border-radius: 14px;
  padding: 60px 20px 20px; /* top padding larger for crown.webm */
  max-width: 400px;
  width: 75%;
  box-shadow: 
  text-align: center;
  box-shadow: 0 4px 10px rgba(0,0,0,0.4); /* subtle shadow only */
}

.popup h2 {
  color: #ffd36a;
  margin-top: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.popup video {
  width: 60px;
  height: 60px;
  position: absolute;
  top: -30px;
  left: 50%;
  transform: translateX(-50%);
  border-radius: 50%;
  object-fit: cover;
  background: transparent;
}

.close {
  position: absolute;
  top: 12px;
  right: 14px;
  cursor: pointer;
  font-size: 18px;
}

.prize-item { margin: 14px 0; }
.prize-item span {
  display: block;
  font-size: 13px;
  color: #cfcfcf;
  align-items: center;
}

/* MOBILE FIX */
@media (max-width: 600px) {
  .site-row {
    min-height: 62px;
  }

  .site-logo img {
    width: 148px;
  }

  .site-btn {
    padding: 7px 12px;
    font-size: 12px;
  }

  .site-menu a {
    font-size: 13px;
    padding: 10px 12px;
  }

  /* Keep top 3 side-by-side, shrink slightly */
  .top3 {
    grid-template-columns: 1fr 1.2fr 1fr;
    gap: 8px;
  }
  .top-card.first img { width: 120px; }
  .top-card img { width: 90px; }

  /* Popup width same as board */
  .popup { max-width: 100%; width: 100%; margin: 10px; }
}
</style>
</head>

<body>
<div class="site-header">
  <div class="site-header-top">
    <div class="site-container">
      <div class="site-row">
        <a class="site-logo" href="/index.html">
          <img src="images/bg.png" alt="Bhaggo logo">
        </a>
        <div class="site-actions">
          <a href="https://english-bhaggopartnerform.my.canva.site/" class="site-btn">Join Now</a>
          <a href="https://t.me/BhaggoPartnersSupport_bot?start=w46997251" class="site-btn">Contact Us</a>
        </div>
      </div>
    </div>
  </div>
  <div class="site-header-bottom">
    <div class="site-container">
      <ul class="site-menu">
        <li><a href="/home">Home</a></li>
        <li><a href="/commission.html">Commission Structure</a></li>
        <li><a href="/leaderboard.html" class="active">Lanka Retreat Promo</a></li>
        <li><a href="/contactus.html">Contact Us</a></li>
      </ul>
    </div>
  </div>
</div>

<div class="leaderboard-page">
<div class="container">

<div class="board-header">
  <div class="logo">
    <img src="https://www.bhaggo.co/static/svg/logo_bhagyo_white.svg">
  </div>
  <h1>লঙ্কা রিট্রিট লিডারবোর্ড</h1>
  <div><b>১ ফেব্রুয়ারি ২০২৬ – ৩০ এপ্রিল ২০২৬</b></div>
  <div class="prize-link" onclick="openPrize()"><b>পুরস্কারের বিস্তারিত দেখুন &nbsp;→</b></div>
</div>

<div class="top3">
  <div id="second" class="top-card">
    <img src="https://www.betjuicy.com/leaderboard/raffles-second.svg">
    <div class="top-name"></div>
    <div class="top-points"></div>
  </div>

  <div id="first" class="top-card first">
    <img src="https://www.betjuicy.com/leaderboard/raffles-first.svg">
    <div class="top-name"></div>
    <div class="top-points"></div>
  </div>

  <div id="third" class="top-card">
    <img src="https://www.betjuicy.com/leaderboard/raffles-third.svg">
    <div class="top-name"></div>
    <div class="top-points"></div>
  </div>
</div>

<div class="board">
  <div class="header-row">
    <div class="pos">পজিশন</div>
    <div class="user">ইউজারনেম</div>
    <div class="prize">মোট পয়েন্ট</div>
  </div>

  <div id="list"></div>
  <div id="lastUpdated" class="meta"></div>
</div>

</div>
</div>

<!-- POPUP -->
<div class="popup-overlay" id="popup" onclick="outsideClose(event)">
  <div class="popup">
    <div class="close" onclick="closePrize()">✕</div>
    <h2>
      <video src="https://www.betjuicy.com/videos/crown.webm" autoplay loop muted playsinline></video>
      পুরস্কারের তালিকা
    </h2>

    <div class="prize-item">
      <b>১ম পুরস্কার: ফুল প্যাকেজ</b>
      <span>ভিসা, ইকোনমি ফ্লাইট, ৪-স্টার হোটেল, ফুল বোর্ড খাবার, শেয়ার্ড পিকআপ/ড্রপ</span>
    </div>

    <div class="prize-item">
      <b>২য়–৩য় পুরস্কার: হাফ প্যাকেজ</b>
      <span>ইকোনমি ফ্লাইট, ৪-স্টার হোটেল, হাফ বোর্ড খাবার, শেয়ার্ড পিকআপ/ড্রপ</span>
    </div>

    <div class="prize-item">
      <b>৪র্থ–৭ম পুরস্কার: পার্শিয়াল প্যাকেজ</b>
      <span>ইকোনমি ফ্লাইট, ৪-স্টার হোটেল, শেয়ার্ড পিকআপ/ড্রপ</span>
    </div>
  </div>
</div>

<script>
function openPrize(){ popup.style.display="flex"; }
function closePrize(){ popup.style.display="none"; }
function outsideClose(e){ if(e.target.id==="popup") closePrize(); }

const SHEET_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vQyA_oyvC1pvQgsKqxuuCvsJ_KC2xVc89LrqnXjW6BAgBxF9omLbENsd7veZHndDLriUCGglM_MtT_B/pub?gid=0&single=true&output=csv";

/* Correct CSV parser for large numbers */
async function fetchCSV(url){
  const res = await fetch(url);
  const text = await res.text();
  const rows = [];
  const regex = /("([^"]|"")*"|[^,]+)(?=\s*,|\s*$)/g;
  text.split("\n").forEach(line=>{
    const cells=[];
    let match;
    while((match=regex.exec(line))!==null){
      cells.push(match[0].replace(/^"|"$/g,"").replace(/""/g,'"').trim());
    }
    if(cells.length) rows.push(cells);
  });
  return rows;
}

async function load(){
  const rows = await fetchCSV(SHEET_URL);
  const [, ...data] = rows;

  const sorted = data.filter(r=>r[1]&&r[2])
    .map(r=>({u:r[1], p:Number(String(r[2]).replace(/,/g,""))||0}))
    .sort((a,b)=>b.p-a.p);

  const [f,s,t,...rest] = sorted;

  if(f){ first.children[1].textContent=f.u; first.children[2].textContent=f.p+" পয়েন্ট"; }
  if(s){ second.children[1].textContent=s.u; second.children[2].textContent=s.p+" পয়েন্ট"; }
  if(t){ third.children[1].textContent=t.u; third.children[2].textContent=t.p+" পয়েন্ট"; }

  list.innerHTML = rest.map((r,i)=>`
    <div class="row">
      <div class="pos">${i+4}</div>
      <div class="user">${r.u}</div>
      <div class="prize">${r.p} পয়েন্ট</div>
    </div>`).join("");

  lastUpdated.textContent = "সর্বশেষ আপডেট: " + new Date().toLocaleString();
}

load();
setInterval(load, 3600000);
</script>

</body>
</html>
